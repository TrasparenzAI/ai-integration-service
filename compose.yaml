#Da utilizzare per lo sviluppo in locale, ma non con il modello Mixtral
#e previa abilitazione nel pom.xml del spring-boot-docker-compose
services:
  ollama:
    image: 'ollama/ollama:latest'
    ports:
      - '11434:11434'
    volumes:
      - ollama:/root/.ollama
    healthcheck:
      test: ["CMD", "bash", "-lc", "curl -sSf http://localhost:11434/api/tags > /dev/null"]
      interval: 10s
      timeout: 5s
      retries: 10
    environment:
      - OLLAMA_KEEP_ALIVE=24h
      # Opzionale: pre-pull del modello al primo avvio (richiede internet)
    command: ["sh", "-c", "ollama serve & sleep 2 && ollama pull mixtral:8x7b-instruct-v0.1-q5_K_M && wait"]

volumes:
  ollama:
