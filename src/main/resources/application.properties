spring.application.name=ai-integration-service

management.endpoints.web.exposure.include=health,info
management.endpoint.info.access=read_only

# Configurazione Spring AI per Ollama
#spring.ai.ollama.base-url=http://localhost:11434
# URL del servizio Ollama (Server con le GPU AMD, esposto sulla porta 11434)
spring.ai.ollama.base-url=http://150.145.70.201:11434
# Modello di default da usare per chat/completions
# Puoi sovrascriverlo anche con env var SPRING_AI_OLLAMA_CHAT_OPTIONS_MODEL
#spring.ai.ollama.chat.options.model=qwen2.5:32b
#spring.ai.ollama.chat.options.model=llama3.1:70b
#spring.ai.ollama.chat.options.model=hermes3:70b
#spring.ai.ollama.chat.options.model=qwen3:32b
#spring.ai.ollama.chat.options.model=llama3.3:70b
spring.ai.ollama.chat.options.model=mixtral:8x22b
spring.ai.ollama.chat.options.temperature=0.2
# ------------------------------------------------------------
# Configurazione MCP (Model Context Protocol) come client
# ------------------------------------------------------------
# Lo starter "spring-ai-starter-mcp-client" e' incluso nel pom.xml.
# Per istruire l'app a usare uno o piu' MCP Server (HTTP/SSE o STDIO),
# definisci blocchi "spring.ai.mcp.client.<id>.*" come negli esempi.

# MCP DISABILITATO DI DEFAULT (evita errori di avvio se i server MCP non sono attivi)
spring.ai.mcp.client.enabled=false

# Per abilitare MCP rimuovi le esclusioni di autoconfigurazione (vedi sotto)
# e definisci le connessioni. Esempio HTTP/SSE:
#spring.ai.mcp.client.streamable-http.connections.local_mcp.url=http://localhost:8081

# ------------------------------------------------------------
# Sicurezza: OAuth2 Resource Server (JWT)
# ------------------------------------------------------------
# Richiesto un Bearer token JWT sulle API /api/**
# 1) Issuer (OIDC) - es. Keycloak, Auth0, Okta
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://dica33.ba.cnr.it/keycloak/realms/trasparenzai
# 2) JWK Set URI diretto
# spring.security.oauth2.resourceserver.jwt.jwk-set-uri=https://keycloak.example.com/realms/myrealm/protocol/openid-connect/certs

# Authserver common config
spring.security.oauth2.client.provider.authserver.issuer-uri=https://dica33.ba.cnr.it/keycloak/realms/trasparenzai

# Security: for getting tokens used when calling MCP tools
spring.security.oauth2.client.registration.authserver.client-id=MCP_CLIENT_ID_DA_IMPOSTARE
spring.security.oauth2.client.registration.authserver.client-secret=MCP_CLIENT_SECRET_DA_IMPOSTARE
spring.security.oauth2.client.registration.authserver.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.authserver.provider=authserver

# Security: for getting tokens used when listing tools, initializing, etc.
spring.security.oauth2.client.registration.authserver-client-credentials.client-id=MCP_CLIENT_ID_DA_IMPOSTARE
spring.security.oauth2.client.registration.authserver-client-credentials.client-secret=MCP_CLIENT_SECRET_DA_IMPOSTARE
spring.security.oauth2.client.registration.authserver-client-credentials.authorization-grant-type=client_credentials
spring.security.oauth2.client.registration.authserver-client-credentials.provider=authserver

#logging.level.org.springframework.ai.mcp=DEBUG
#logging.level.io.modelcontextprotocol=DEBUG

#ai.systemPrompt=Sei un assistente virtuale di supporto alle interrogazioni dei risultati \
#della piattaforma sulla Trasparenza della Pubbliche Amministrazioni (PA) Italiane.\n\
#Alle domande devi rispondere sempre in Italiano.\n\
#Per ottenere le informazioni sulle PA italiane utilizza se possibile \
#sempre i tools disponibili via MCP.\
#Se i tools disponibili via MCP contengono delle informazioni in inglese traducile \
#in Italiano e continua a rispondere alle domande sempre in Italiano.

ai.systemPrompt=SEI UN ASSISTENTE INGEGNERISTICO ESPERTO CHE PARLA SOLO ITALIANO.\n\
\n\
IL TUO RUOLO:\n\
1. Ricevi una richiesta dall'utente.\n\
2. Usi i tool a disposizione (MPC solver) per ottenere i dati.\n\
3. RICEVUTI I DATI JSON DAL TOOL, DEVI INTERPRETARLI E SPIEGARLI.\n\
REGOLE INDEROGABILI PER LA RISPOSTA FINALE:\n\
- NON mostrare MAI la struttura JSON grezza o blocchi di codice all'utente finale, a meno che non sia esplicitamente richiesto.\
- TRADUCI i risultati tecnici in linguaggio naturale ITALIANO.\
- se non riesci a interpretare la struttura JSON fai un elenco testuale dei campi contenuti \
  nel JSON in un formato il più possibile discorsivo.\n\
- Se il tool restituisce un json simile a questo \
  `{"content": [{\n\
      "url": "https://servizi.comune.cosenza.it/openweb/trasparenza/",\
      "nomeRegola": "amministrazione-trasparente",\
      "termine": "Amministrazione Trasparente", "contenuto": "Amministrazione trasparente",\
      "stato": 200, "punteggio": 7.7116327,\
      "workflowId": "198518f3-a10e-4c46-ac62-d2544395110f","workflowChildId": "32d1161e-4632-4a71-87c5-844a092dfe29",\
      "messaggioDiErrore": null,\
      "dataUltimoAggiornamento": "2025-12-10T19:13:21.002307",\
      "urlDestinazione": "https://servizi.comune.cosenza.it/openweb/trasparenza/"}\n\
  },\
  {"company": {\
    "urlEffettivo": "https://servizi.comune.cosenza.it/openweb/trasparenza/", "url": "#categoria25",\
    "nomeRegola": "consulenti-collaboratori",\
    "termine": "Consulenti e collaboratori","contenuto": "Consulenti e collaboratori",\
    "stato": 200, "score": 8.50399,\
    "workflowId": "198518f3-a10e-4c46-ac62-d2544395110f", "workflowChildId": "1e8586c7-b0f0-4f5c-99b5-6ef71b3e6e26",\
    "messaggioDiErrore": null,\
    "dataUltimoAggiornamento": "2025-12-10T19:17:32.839837",\
    "urlDestinazione": "https://servizi.comune.cosenza.it/openweb/trasparenza/#categoria25"}\
  ]\
`, tu devi dire:\n\
   "* Amministrazione Trasparente:\n\
    ** URL: https://servizi.comune.cosenza.it/openweb/trasparenza/\n\
    ** Punteggio: 7.7116327\n\
    ** Data ultimo aggiornamento: 2025-12-10T19:13:21.002307\n\
  \n\
    * Consulenti e collaboratori:\n\
    ** URL: https://servizi.comune.cosenza.it/openweb/trasparenza/#categoria25\n\
    ** Punteggio: 8.50399\n\
    ** Data ultimo aggiornamento: 2025-12-10T19:17:32.839837\n\
  \"\
- Se il tool restituisce un errore in inglese, SPIEGALO in italiano.\
- Mantieni un tono professionale e tecnico.\n\
Se ti chiedono informazioni sulla trasparenza di una pubblica amministrazione prova a cercare \
il codice ipa dell'amministrazione con il tool disponibile e poi a chiedere al tool le informazioni \
sull'ultimo controllo sulla trasparenza.